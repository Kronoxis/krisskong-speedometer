<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Speedometer</title>

    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/overlay.css" />

    <!-- Fonts --> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sofia+Sans+Condensed:wght@600&display=swap" rel="stylesheet">
</head>

<body>
    <div id="speedometer">
        <svg id="b" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 400 400">
            <defs>
                <style>
                    .g {
                        fill: url(#e);
                    }

                    .g,
                    .h,
                    .i {
                        stroke-width: 0px;
                    }

                    .j {
                        clip-path: url(#d);
                    }

                    .h {
                        fill: none;
                    }

                    .k {
                        opacity: .4;
                    }

                    .l {
                        clip-path: url(#c);
                    }

                    .m {
                        font-family: SofiaProSemiBold, 'Sofia Pro';
                        font-size: 24px;
                        letter-spacing: -.08em;
                    }

                    .m,
                    .i {
                        fill: #fff;
                    }
                </style>
                <clipPath id="c">
                    <path class="h"
                        d="M0,0v400h165.2703l21.2211-122.207c-37.173-6.4115-65.4591-38.7887-65.4591-77.793,0-43.6127,35.355-78.9678,78.9677-78.9678s78.9677,35.3551,78.9677,78.9678h121.0323V0H0Z" />
                </clipPath>
                <clipPath id="d">
                    <path class="h"
                        d="M12.2324,131.9244l48.9518,17.817,64.5132,23.4809c-1.4865,4.1237-2.6236,8.4113-3.4105,12.8212L3.3506,165.0718l8.8818-33.1474ZM3.2637,234.4355l118.9271-20.9697c-.7389-4.2974-1.1387-8.7104-1.1528-13.2158H.2729l2.9907,34.1855ZM.2729,199.75h120.7657c.014-4.5057.4216-8.9164,1.1605-13.2145L3.2637,165.564.2729,199.75ZM125.7059,226.7745c-1.4875-4.1243-2.6491-8.4036-3.4364-12.8146L3.3506,234.9287l8.8818,33.1465,113.4735-41.3007ZM160.3062,268.2514c-3.838-2.2355-7.4738-4.7799-10.8653-7.6084l-77.6317,92.5182,28.1108,19.6826,60.3862-104.5923ZM139.3622,250.5545c-2.8315-3.39-5.3864-7.0175-7.6243-10.8545l-104.5817,60.3801,19.6831,28.1094,92.5228-77.6349ZM127.5431,241.5444l3.9499-2.2805c-2.1942-3.8176-4.0822-7.8322-5.6218-12.0172l-113.4678,41.2993,14.5027,31.101,100.6371-58.1025ZM100.353,26.9062l60.3846,104.5894c3.8186-2.1934,7.8266-4.0939,12.0124-5.6329L131.4541,12.4033l-31.1011,14.5029ZM131.9239,12.2324l17.6334,48.4472,23.6647,65.0179c4.1238-1.4865,8.4114-2.6237,12.8214-3.4106L165.0718,3.3506l-33.1479,8.8818ZM12.4033,131.4546l113.4594,41.2956c1.5391-4.1859,3.4395-8.1938,5.6329-12.0126L26.9062,100.353l-14.5029,31.1016ZM186.5355,122.199c4.2982-.7388,8.7089-1.1464,13.2145-1.1605V.2729l-34.186,2.9907,20.9715,118.9354ZM27.1562,99.9199l104.5887,60.3842c2.237-3.838,4.7771-7.476,7.6075-10.8672L46.8393,71.8091l-19.683,28.1108ZM47.1606,71.4263l92.5192,77.6328c2.8594-3.3825,5.9968-6.5198,9.3792-9.3792L71.4263,47.1606l-24.2656,24.2656ZM71.8091,46.8394l77.6277,92.5131c3.3912-2.8304,7.0292-5.3705,10.8672-7.6075l-49.3834-85.5348-11.0008-19.0539-28.1107,19.6831ZM149.0637,260.3145c-3.3831-2.8579-6.5252-5.9912-9.3854-9.3721l-92.5176,77.6318,24.2656,24.2646,77.6374-92.5244ZM227.25,125.8627c4.1858,1.539,8.1937,3.4395,12.0123,5.6329l14.6014-25.2901,45.7834-79.2994-31.1008-14.5026-41.2963,113.4592ZM264.1127,89.4538l-24.4167,42.2911c3.838,2.237,7.4759,4.7771,10.8671,7.6075l77.6274-92.5131-28.1101-19.6829-35.9676,62.2974ZM213.9568,122.2869c4.4099.7869,8.6974,1.9241,12.8212,3.4106l23.6647-65.0179,17.6334-48.4472-33.1474-8.8818-20.9719,118.9363ZM2.7697,165.4769l-.0432-.0076.0652-.2448.0217-.2474.0426.0075,8.9047-33.2318-.041-.015.1059-.2271.065-.2427.0411.015,14.5397-31.1811-.0378-.0219.1438-.2054.1062-.2277.0379.0219,19.7334-28.1823-.0335-.0281.1776-.1776.1437-.2052.0334.0281,24.3276-24.3276-.0281-.0334.2052-.1437.1776-.1776.0281.0336,28.1823-19.7335-.0219-.0379.2277-.1062.2054-.1438.0219.0378,31.1806-14.5397-.015-.0411.244-.0656.2257-.1053.0148.0408,33.2325-8.9041-.0076-.0429.2492-.0218.243-.0651.0076.0432,31.6539-2.7697H0v197.1307l2.7697-31.6539ZM234.5226,2.7697l.0076-.0431.2443.0651.2489.0218-.0076.0428,33.2319,8.9044.015-.041.2271.1059.2427.065-.0149.0412,31.1804,14.5398.022-.038.2064.1445.2263.1055-.0217.0377,28.1824,19.7332.0278-.0331.1768.1764.207.1449-.0283.0337,24.3275,24.327.0329-.0276.1444.205.1779.1779-.0336.0281,19.733,28.1823.0379-.0219.1062.2277.1438.2054-.0378.0219,14.5397,31.1811.0411-.015.0651.2427.1058.2271-.041.015,8.9053,33.2319.043-.0076.0214.2476.0656.2446-.0435.0076,2.7691,31.6582V0h-197.1307l31.6533,2.7697ZM172.7587,274.1132c-4.1845-1.5378-8.2032-3.4179-12.0209-5.6093l-60.3848,104.5898,31.1011,14.5029,41.3046-113.4835ZM250.9411,139.6799c3.3824,2.8594,6.5195,5.9966,9.379,9.379l92.5188-77.6327-24.2646-24.2656-77.6331,92.5193ZM165.4692,397.2734l-.2637-.0713-33.4533-8.963-.015.0411-.2277-.1062-.2415-.0647.0149-.041-31.181-14.5399-.0219.0378-.2067-.1445-.2264-.1055.0218-.0377-28.1816-19.7338-.0286.0341-.1793-.1797-.2035-.1425.0278-.0332-24.3274-24.3279-.0334.0281-.1426-.2042-.1786-.1786.0338-.0283-19.7339-28.182-.0377.0218-.1055-.2263-.1445-.2064.038-.022-14.5402-31.1813-.0408.0148-.0644-.2404-.1065-.2283.0413-.0151-8.9043-33.2318-.0432.0076-.0219-.2507-.065-.2425.0431-.0075-2.7697-31.6534v197.1307h165.2703l18.2779-105.2579-18.079,102.5314ZM277.8009,186.5355c.7388,4.2982,1.1464,8.7089,1.1605,13.2145h120.7662l-2.9912-34.186-118.9354,20.9715ZM260.6476,149.437c2.8304,3.3912,5.3704,7.0291,7.6074,10.8671l85.5349-49.3834,19.0539-11.0008-19.6826-28.1107-92.5135,77.6279ZM186.0447,277.7056c-4.4091-.7868-8.6926-1.9352-12.816-3.4208l-41.3044,113.4827,33.1475,8.8809,20.9729-118.9428ZM234.4355,3.2637L200.25.2729v120.7656c4.5056.014,8.9163.4216,13.2144,1.1604L234.4355,3.2637ZM268.5043,160.7376c2.1934,3.8187,4.0939,7.8267,5.6329,12.0126l113.4594-41.2956-14.5029-31.1016-104.5894,60.3846ZM296.6851,165.0757l-22.3826,8.1466c1.4865,4.1238,2.6237,8.4113,3.4105,12.8211l118.9364-20.9716-8.8818-33.1473-91.0825,33.1512Z" />
                </clipPath>
                <radialGradient id="e" cx="200" cy="200" fx="200" fy="200" r="190" gradientUnits="userSpaceOnUse">
                    <stop offset="0" stop-color="#a21900" stop-opacity=".8" />
                    <stop offset=".1663" stop-color="rgba(162,25,0,.7067)" stop-opacity=".7067" />
                    <stop offset=".487" stop-color="rgba(162,25,0,.4622)" stop-opacity=".4622" />
                    <stop offset=".9261" stop-color="rgba(162,25,0,.0703)" stop-opacity=".0703" />
                    <stop offset="1" stop-color="#a21900" stop-opacity="0" />
                </radialGradient>
            </defs>
            <g class="l">
                <g class="k">
                    <path class="i"
                        d="M200,10c104.9341,0,190,85.0659,190,190s-85.0659,190-190,190S10,304.9341,10,200,95.0659,10,200,10M200,6c-26.188,0-51.5949,5.1299-75.5148,15.2471-23.1019,9.7713-43.8486,23.7588-61.6639,41.5742s-31.8029,38.5621-41.5742,61.6639c-10.1172,23.9198-15.2471,49.3267-15.2471,75.5148s5.1299,51.5949,15.2471,75.5148c9.7713,23.1019,23.7588,43.8486,41.5742,61.6639,17.8153,17.8153,38.5621,31.8029,61.6639,41.5742,23.9198,10.1172,49.3267,15.2471,75.5148,15.2471s51.5949-5.1299,75.5148-15.2471c23.1019-9.7713,43.8486-23.7589,61.6639-41.5742,17.8153-17.8153,31.8029-38.562,41.5742-61.6639,10.1172-23.9198,15.2471-49.3267,15.2471-75.5148s-5.1299-51.5949-15.2471-75.5148c-9.7713-23.1019-23.7589-43.8486-41.5742-61.6639-17.8153-17.8153-38.562-31.8029-61.6639-41.5742-23.9198-10.1172-49.3267-15.2471-75.5148-15.2471h0Z" />
                </g>
                <path class="i"
                    d="M200,11c25.5153,0,50.2668,4.997,73.567,14.8521,22.5059,9.5192,42.7185,23.1469,60.0762,40.5046,17.3578,17.3577,30.9855,37.5703,40.5047,60.0762,9.8551,23.3002,14.8521,48.0517,14.8521,73.567s-4.997,50.2668-14.8521,73.567c-9.5192,22.5059-23.1469,42.7185-40.5047,60.0762-17.3577,17.3578-37.5703,30.9855-60.0762,40.5047-23.3002,9.8551-48.0517,14.8521-73.567,14.8521s-50.2668-4.997-73.567-14.8521c-22.5059-9.5192-42.7185-23.1469-60.0762-40.5047-17.3577-17.3577-30.9854-37.5703-40.5046-60.0762-9.8552-23.3002-14.8521-48.0517-14.8521-73.567s4.997-50.2668,14.8521-73.567c9.5192-22.5059,23.1469-42.7185,40.5046-60.0762,17.3577-17.3577,37.5703-30.9854,60.0762-40.5046,23.3002-9.8552,48.0517-14.8521,73.567-14.8521M200,10C95.0659,10,10,95.0659,10,200s85.0659,190,190,190,190-85.0659,190-190S304.9341,10,200,10h0Z" />
            </g>
            <g class="j">
                <circle class="g" cx="200" cy="200" r="190" />
            </g><text class="m" transform="translate(160.7901 380.3546)">
                <tspan x="0" y="0">0</tspan>
            </text><text class="m" transform="translate(42.2094 297.4411)">
                <tspan x="0" y="0">50</tspan>
            </text><text class="m" transform="translate(25.1772 149.9998)">
                <tspan x="0" y="0">100</tspan>
            </text><text class="m" transform="translate(123.3957 45.5698)">
                <tspan x="0" y="0">150</tspan>
            </text><text class="m" transform="translate(261.261 57.4255)">
                <tspan x="0" y="0">200</tspan>
            </text><text class="m" transform="translate(349.3179 206.9742)">
                <tspan x="0" y="0">260</tspan>
            </text>
        </svg>
        <div id="speed">0</div>
    </div>
    <script>
        class Speedometer {
            constructor() {
                this.element = document.querySelector("#speedometer");
                this.display = this.element.querySelector("#speed");
                this._speed = 0;
                this._target = 0;
                this._update = this.update.bind(this);
                this._time = -1;
            }

            get speed() { return this._speed; }
            set speed(speed) { this._target = speed; }

            update(time) {
                if (this._time > 0) {
                    const deltaTime = (time - this._time) * 0.001;
                    const t = Math.min(deltaTime, Math.max(deltaTime, 0.001), 0.2);
                    this._speed = this._speed * (1 - t) + this._target * t;
                    this.display.innerHTML = `${this._speed.toFixed(0)}`;
                }
                this._time = time;
                requestAnimationFrame(this._update);
            }
        }

        const speedometer = new Speedometer();
        setInterval(updateSpeed, 2000);
        speedometer.update();

        async function updateSpeed() {
            const speed = await getSpeed();
            speedometer.speed = Math.min(speed, Math.max(speed, 0), 260);
        }

        async function getSpeed() {
            const endpoint = "http://localhost:3000/speed";//https://krisskong-speedometer.glitch.me/speed";
            const response = await fetch(endpoint, { method: "GET" });
            const speed = await response.text();
            return parseFloat(speed);
        }
    </script>
</body>

</html>